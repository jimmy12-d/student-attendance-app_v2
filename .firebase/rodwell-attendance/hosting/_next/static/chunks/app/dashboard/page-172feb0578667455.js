(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{3553:(e,t,a)=>{Promise.resolve().then(a.bind(a,4085))},657:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(5155),n=a(1063),s=a(2115),r=a(6778),c=a(2079),o=a(2781);let i=e=>{let{outline:t=!1,children:a,...i}=e,d=t?r.Fw[i.color]:r.cu[i.color],[u,m]=(0,s.useState)(!1);return u?null:(0,l.jsx)("div",{className:"px-3 py-6 md:py-3 mb-6 last:mb-0 border rounded-lg transition-colors duration-150 ".concat(d),children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-center mb-6 md:mb-0",children:[i.icon&&(0,l.jsx)(o.A,{path:i.icon,w:"w-10 md:w-5",h:"h-10 md:h-5",size:"24",className:"md:mr-2"}),(0,l.jsx)("span",{className:"text-center md:text-left md:py-2",children:a})]}),i.button,!i.button&&(0,l.jsx)(c.A,{icon:n.hyP,color:"white",onClick:e=>{e.preventDefault(),m(!0)},small:!0,roundedFull:!0})]})})}},8574:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(5155);a(2115);var n=a(6778),s=a(2781);function r(e){let{label:t="",className:a="",icon:n=null,small:r=!1,onClick:c,onIconClick:o,labelClassName:i="",children:d}=e,u=r?"text-xs":"text-sm",m=n?o?(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),o()},className:"flex-none items-center justify-center p-0.5 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none ".concat(r&&t?"mr-1":"mr-1.5"),"aria-label":"icon-action",children:(0,l.jsx)(s.A,{path:n,w:"w-4",h:"h-4",size:r?14:20})}):(0,l.jsx)(s.A,{path:n,w:"w-4",h:"h-4",className:r&&t?"mr-1":"mr-1.5",size:r?14:void 0}):null;return(0,l.jsxs)("div",{className:"inline-flex items-center capitalize ".concat(u," ").concat(a," ").concat(c?"cursor-pointer":""),onClick:c,children:[m," ",t&&(0,l.jsx)("span",{className:"px-1 ".concat(i||""),children:t}),d]})}let c=e=>{let{small:t=!1,outline:a=!1,className:s="",onClick:c,onIconClick:o,labelClassName:i,...d}=e,u=a?n.Fw[d.color]:n.cu[d.color],m=d.isGrouped?"mr-3 last:mr-0 mb-3":"",h=c&&!o?"cursor-pointer":"";return(0,l.jsx)(r,{className:"border rounded-full ".concat("py-1 px-3"," ").concat(u," ").concat(m," ").concat(h," ").concat(s),icon:d.icon,label:d.label,small:t,onClick:c,onIconClick:o,labelClassName:i})}},5632:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(5155);a(2115);var n=a(9732);function s(e){let{children:t}=e;return(0,l.jsx)("section",{className:"bg-gray-100 dark:bg-gray-800 p-6 ".concat(n.Fx),children:t})}},198:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(5155);a(2115);var n=a(2781),s=a(6778);function r(e){let{icon:t,color:a,w:r="w-12",h:c="h-12",bg:o=!1,className:i=""}=e,d=o?s.cu[a]:"".concat(s.Wj[a]," bg-gray-50 dark:bg-slate-800");return(0,l.jsx)(n.A,{path:t,w:r,h:c,size:"24",className:"rounded-full ".concat(d," ").concat(i)})}function c(e){let{icon:t,title:a,main:s=!1,children:c}=e;return(0,l.jsxs)("section",{className:"".concat(s?"":"pt-6"," mb-6 flex items-center justify-between"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-start",children:[t&&s&&(0,l.jsx)(r,{icon:t,color:"light",className:"mr-3",bg:!0}),t&&!s&&(0,l.jsx)(n.A,{path:t,className:"mr-2",size:"20"}),(0,l.jsx)("h1",{className:"leading-tight ".concat(s?"text-3xl":"text-2xl"),children:a})]}),c]})}},9732:(e,t,a)=>{"use strict";a.d(t,{Fx:()=>l,wS:()=>n});let l="xl:max-w-6xl xl:mx-auto",n=e=>"".concat(e," â€” ").concat("Rodwell Attendance")},4085:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var l=a(5155),n=a(2115),s=a(1063),r=a(2079),c=a(5632),o=a(198),i=a(6778),d=a(2781),u=a(4713),m=a(7801),h=a.n(m);let x=e=>{let{prefix:t="",suffix:a="",value:s,duration:r=500}=e,[c,o]=(0,n.useState)(0),i=c<1e3?c:h()(c).format("0,0"),d=[],u=e=>{let t=Math.ceil(c+e);if(t>s)return o(s),!1;o(t),d.push(setTimeout(()=>{u(e)},25))};return(0,n.useEffect)(()=>(u(s/(r/25)),()=>{d.forEach(e=>{clearTimeout(e)})})),(0,l.jsxs)("div",{children:[t,i,a]})};var b=a(8574);let g=e=>{let{small:t=!1,...a}=e,n={up:s.Fb5,down:s.W5x,success:s.rvk,danger:s.PoQ,warning:s.VX1,info:s.nO4}[a.type];return(0,l.jsx)(b.A,{label:a.label,color:a.color,icon:n,small:t})},f=e=>(0,l.jsxs)(u.A,{children:[e.trendLabel&&e.trendType&&e.trendColor&&(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)(g,{label:e.trendLabel,type:e.trendType,color:e.trendColor,small:!0}),(0,l.jsx)(r.A,{icon:s.CZ3,color:"lightDark",small:!0})]}),(0,l.jsxs)("div",{className:"py-1 px-3 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg leading-tight text-gray-500 dark:text-slate-400",children:e.label}),(0,l.jsx)("h1",{className:"text-3xl leading-tight font-semibold",children:(0,l.jsx)(x,{value:e.number,prefix:e.numberPrefix,suffix:e.numberSuffix})})]}),e.icon&&(0,l.jsx)(d.A,{path:e.icon,size:"48",w:"",h:"h-16",className:i.Wj[e.iconColor]})]})]});var p=a(657),j=a(5111),v=a(7058),w=a(7711),y=a(8449),N=a(9532);function A(){let[e,t]=(0,n.useState)([]),[a,i]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(null),[x,b]=(0,n.useState)((0,y.AZ)()),[g,w]=(0,n.useState)([]),[A,S]=(0,n.useState)(!1),k=(0,n.useRef)(null),[C,P]=(0,n.useState)(null),[M,E]=(0,n.useState)(!0),[D,G]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=[],t=new Date,a=t.getFullYear(),l=t.getMonth();for(let t=0;t<=l;t++){let l=new Date(a,t,1);e.push({value:"".concat(a,"-").concat(String(t+1).padStart(2,"0")),label:l.toLocaleString("default",{month:"long",year:"numeric"})})}w(e.reverse())},[]),(0,n.useEffect)(()=>{let e=e=>{k.current&&!k.current.contains(e.target)&&S(!1)};return A&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[A]);let F=(0,n.useCallback)(async()=>{u(!0),E(!0),h(null);try{let e=(0,v.GG)((0,v.P)((0,v.rJ)(j.db,"students"),(0,v.My)("fullName"))),a=new Date;a.setDate(a.getDate()-60);let l="".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0"),"-").concat(String(a.getDate()).padStart(2,"0")),n=(0,v.GG)((0,v.P)((0,v.rJ)(j.db,"attendance"),(0,v._M)("date",">=",l),(0,v.My)("date","desc"))),s=(0,v.GG)((0,v.P)((0,v.rJ)(j.db,"classes"),(0,v.My)("name"))),r=(0,v.GG)((0,v.P)((0,v.rJ)(j.db,"permissions"),(0,v._M)("status","==","approved"))),[c,o,d,u]=await Promise.all([e,n,s,r]),m=c.docs.map(e=>({id:e.id,...e.data(),createdAt:e.data().createdAt}));t(m);let h=o.docs.map(e=>({id:e.id,...e.data()}));i(h);let x=u.docs.map(e=>({id:e.id,...e.data()}));G(x),console.log("Dashboard: Fetched ".concat(x.length," approved permissions."));let b={};d.empty&&console.warn("No documents found in 'classes' collection for dashboard."),d.forEach(e=>{b[e.id]=e.data()}),P(b),E(!1)}catch(e){console.error("Error fetching dashboard data:",e),h("Failed to load dashboard data."),"failed-precondition"===e.code&&e.message.includes("index")&&h("Query requires a new index. Check console for link."),E(!1)}u(!1)},[]);(0,n.useEffect)(()=>{F()},[F]);let L=(0,y.AZ)(new Date).substring(0,7)+"-"+String(new Date().getDate()).padStart(2,"0"),T=(0,n.useMemo)(()=>a.filter(e=>e.date===L&&"present"===e.status).length,[a,L]),_=(0,n.useMemo)(()=>a.filter(e=>e.date===L&&"late"===e.status).length,[a,L]),z=(0,n.useMemo)(()=>C&&0!==e.length?e.filter(e=>{let t=a.find(t=>t.studentId===e.id&&t.date===L),l=D.filter(t=>t.studentId===e.id),n=(0,N.tE)(e,L,t,C,l);return"Absent"===n.status||"Absent (Config Missing)"===n.status}).length:0,[e,a,D,C,L]),I=(0,n.useMemo)(()=>C&&0!==e.length?e.filter(e=>{let t=a.find(t=>t.studentId===e.id&&t.date===L),l=D.filter(t=>t.studentId===e.id);return"Pending"===(0,N.tE)(e,L,t,C,l).status}).length:0,[e,a,D,C]);return((0,n.useMemo)(()=>{var e;return(null===(e=g.find(e=>e.value===x))||void 0===e?void 0:e.label)||x},[g,x]),d&&0===e.length||M)?(0,l.jsx)(c.A,{children:(0,l.jsx)("p",{className:"text-center p-6",children:"Loading dashboard data..."})}):(0,l.jsxs)(c.A,{children:[(0,l.jsx)(o.A,{icon:s.FNh,title:"Overview",main:!0,children:(0,l.jsx)(r.A,{onClick:F,icon:s.kWq,label:"Refresh Data",color:"info",small:!0})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 mb-6",children:[(0,l.jsx)(f,{label:"Total Students",number:e.length,icon:s.Krx,iconColor:"info"}),(0,l.jsx)(f,{label:"Present Today",number:T,icon:s.Krx,iconColor:"success"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:[(0,l.jsx)(f,{label:"Late Today",number:_,icon:s.d5P,iconColor:"warning"}),(0,l.jsx)(f,{label:"Absent Today",number:z,icon:s.lBC,iconColor:"danger"}),(0,l.jsx)(f,{label:"Pending Today",number:I,icon:s.MoT,iconColor:"info",trendLabel:"Shift Open"})]}),m&&(0,l.jsx)(p.A,{color:"danger",icon:s.gtj,children:m})]})}(0,w.default)(()=>Promise.all([a.e(104),a.e(660)]).then(a.bind(a,5660)),{loadableGenerated:{webpack:()=>[5660]},ssr:!1,loading:()=>(0,l.jsx)("p",{children:"Loading monthly absences..."})}),(0,w.default)(()=>Promise.all([a.e(104),a.e(263)]).then(a.bind(a,4263)),{loadableGenerated:{webpack:()=>[4263]},ssr:!1,loading:()=>(0,l.jsx)("p",{children:"Loading monthly lates..."})}),(0,w.default)(()=>Promise.all([a.e(104),a.e(243)]).then(a.bind(a,9243)),{loadableGenerated:{webpack:()=>[9243]},ssr:!1,loading:()=>(0,l.jsx)("p",{children:"Loading consecutive absences..."})})}},e=>{var t=t=>e(e.s=t);e.O(0,[779,992,965,164,173,679,84,441,517,358],()=>t(3553)),_N_E=e.O()}]);