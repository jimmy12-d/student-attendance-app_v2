(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[866],{5730:(e,t,a)=>{Promise.resolve().then(a.bind(a,8928))},7738:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(5155);let s=e=>{let{type:t="justify-start",mb:a="-mb-3",noWrap:s=!1,children:r,className:n}=e;return(0,l.jsxs)("div",{className:"flex items-center ".concat(t," ").concat(n," ").concat(a," ").concat(s?"flex-nowrap":"flex-wrap"),children:[r," "]})}},1315:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(5155);a(2115);let s=e=>{let{title:t,children:a}=e;return(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3 pl-4",children:[(0,l.jsx)("h1",{className:"text-2xl",children:t}),a]})}},6706:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var l=a(5155),s=a(1063),r=a(2079),n=a(7738),i=a(4713),c=a(1315),o=a(9912);let d=e=>{let{title:t,buttonColor:a,buttonLabel:d,isActive:u,children:h,modalClassName:x="w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12",onConfirm:g,onCancel:m}=e;if(!u)return null;let p=g&&d&&a?(0,l.jsxs)(n.A,{type:"justify-end",children:[(0,l.jsx)(r.A,{label:d,color:a,onClick:g,isGrouped:!0}),!!m&&(0,l.jsx)(r.A,{label:"Cancel",color:a,outline:!0,onClick:m,isGrouped:!0})]}):null;return(0,l.jsx)(o.A,{onClick:m,className:m?"cursor-pointer":"",children:(0,l.jsxs)(i.A,{className:"transition-transform shadow-lg max-h-modal ".concat(x," z-50"),isModal:!0,footer:p,children:[(0,l.jsx)(c.A,{title:t,children:!!m&&(0,l.jsx)(r.A,{icon:s.hyP,color:"whiteDark",onClick:m,small:!0,roundedFull:!0})}),(0,l.jsx)("div",{className:"space-y-3 pl-4",children:h})]})})}},3061:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var l=a(5155),s=a(2781);let r=e=>{var t;let{htmlFor:a,children:s,...r}=e;return(0,l.jsx)("label",{htmlFor:a,className:"block mb-2 font-semibold ".concat(a?"cursor-pointer":""," ").concat(null!==(t=r.className)&&void 0!==t?t:""),children:(0,l.jsx)("span",{className:"line-clamp-1",children:s})})},n=e=>{let{children:t,...a}=e,n={className:["px-3 py-2 max-w-full border-gray-700 rounded-sm w-full dark:placeholder-gray-400","focus:ring-3 focus:ring-blue-600 focus:border-blue-600 focus:outline-hidden",a.hasTextareaHeight?"h-24":"h-12",a.isBorderless?"border-0":"border",a.isTransparent?"bg-transparent":"bg-white dark:bg-slate-800",a.icon?"pl-10":""].join(" ")};return(0,l.jsxs)("div",{className:"mb-2 last:mb-0",children:[a.label&&(0,l.jsx)(r,{htmlFor:a.labelFor,children:a.label}),(0,l.jsxs)("div",{className:"relative",children:[t(n),a.icon&&(0,l.jsx)(s.A,{path:a.icon,w:"w-10",h:a.hasTextareaHeight?"h-full":"h-12",className:"absolute top-0 left-0 z-10 pointer-events-none text-gray-500 dark:text-slate-400"})]}),a.help&&(0,l.jsx)("div",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:a.help})]})}},657:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var l=a(5155),s=a(1063),r=a(2115),n=a(6778),i=a(2079),c=a(2781);let o=e=>{let{outline:t=!1,children:a,...o}=e,d=t?n.Fw[o.color]:n.cu[o.color],[u,h]=(0,r.useState)(!1);return u?null:(0,l.jsx)("div",{className:"px-3 py-6 md:py-3 mb-6 last:mb-0 border rounded-lg transition-colors duration-150 ".concat(d),children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-center mb-6 md:mb-0",children:[o.icon&&(0,l.jsx)(c.A,{path:o.icon,w:"w-10 md:w-5",h:"h-10 md:h-5",size:"24",className:"md:mr-2"}),(0,l.jsx)("span",{className:"text-center md:text-left md:py-2",children:a})]}),o.button,!o.button&&(0,l.jsx)(i.A,{icon:s.hyP,color:"white",onClick:e=>{e.preventDefault(),h(!0)},small:!0,roundedFull:!0})]})})}},9912:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(5155);function s(e){let{zIndex:t="z-50",type:a="flex",children:s,className:r,...n}=e;return(0,l.jsxs)("div",{className:"".concat(a," ").concat(t," ").concat(r," items-center flex-col justify-center overflow-hidden fixed inset-0"),children:[(0,l.jsx)("div",{className:"overlay absolute inset-0 bg-linear-to-tr opacity-90 dark:from-gray-700 dark:via-gray-900 dark:to-gray-700",onClick:e=>{e.preventDefault(),n.onClick&&n.onClick(e)}}),s]})}a(2115)},5632:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var l=a(5155);a(2115);var s=a(9732);function r(e){let{children:t}=e;return(0,l.jsx)("section",{className:"bg-gray-100 dark:bg-gray-800 p-6 ".concat(s.Fx),children:t})}},198:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(5155);a(2115);var s=a(2781),r=a(6778);function n(e){let{icon:t,color:a,w:n="w-12",h:i="h-12",bg:c=!1,className:o=""}=e,d=c?r.cu[a]:"".concat(r.Wj[a]," bg-gray-50 dark:bg-slate-800");return(0,l.jsx)(s.A,{path:t,w:n,h:i,size:"24",className:"rounded-full ".concat(d," ").concat(o)})}function i(e){let{icon:t,title:a,main:r=!1,children:i}=e;return(0,l.jsxs)("section",{className:"".concat(r?"":"pt-6"," mb-6 flex items-center justify-between"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-start",children:[t&&r&&(0,l.jsx)(n,{icon:t,color:"light",className:"mr-3",bg:!0}),t&&!r&&(0,l.jsx)(s.A,{path:t,className:"mr-2",size:"20"}),(0,l.jsx)("h1",{className:"leading-tight ".concat(r?"text-3xl":"text-2xl"),children:a})]}),i]})}},9732:(e,t,a)=>{"use strict";a.d(t,{Fx:()=>l,wS:()=>s});let l="xl:max-w-6xl xl:mx-auto",s=e=>"".concat(e," â€” ").concat("Rodwell Attendance")},9496:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var l=a(5155),s=a(2115),r=a(7058),n=a(6706),i=a(9532),c=a(8449),o=a(2079),d=a(1063);let u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=e=>{let{student:t,attendanceRecords:a,allClassConfigs:h,approvedPermissions:x,isActive:g,onClose:m,initialMonthValue:p}=e,[f,b]=(0,s.useState)([]),[y,j]=(0,s.useState)(!0),[N,k]=(0,s.useState)(p||(0,c.AZ)()),w=e=>{let[a,l]=N.split("-"),s=parseInt(a),n=parseInt(l)-1;"prev"===e?--n<0&&(n=11,s--):++n>11&&(n=0,s++);let i=new Date(s,n,1),c=new Date;if(!(i>new Date(c.getFullYear(),c.getMonth(),1))){if(t.createdAt){let e=t.createdAt instanceof r.Dc?t.createdAt.toDate():t.createdAt;if(i<new Date(e.getFullYear(),e.getMonth(),1))return}k("".concat(s,"-").concat(String(n+1).padStart(2,"0")))}};(0,s.useEffect)(()=>{if(!g||!t||!h||!N){b([]),g&&j(!1);return}j(!0);let[e,l]=N.split("-"),s=parseInt(e),r=parseInt(l)-1,n=new Date;n.setHours(0,0,0,0);let c=new Map;a.filter(e=>{var t;return null===(t=e.date)||void 0===t?void 0:t.startsWith(N)}).forEach(e=>c.set(e.date,e));let o=new Date(s,r,1).getDay(),d=new Date(s,r+1,0).getDate(),u=[],m=[],p=1;for(let e=0;e<o;e++)m.push({dayOfMonth:null});for(;p<=d;){7===m.length&&(u.push(m),m=[]);let e=new Date(s,r,p);e.setHours(0,0,0,0);let a="".concat(s,"-").concat(String(r+1).padStart(2,"0"),"-").concat(String(p).padStart(2,"0")),l=c.get(a),o=(0,i.tE)(t,a,l,h,x),d={dayOfMonth:p,fullDateStr:a,isToday:e.getTime()===n.getTime(),isPast:e<n,status:o.status,time:o.time,isSchoolDayCell:!["Not Applicable (Holiday/Weekend)","Not Yet Enrolled","No School"].includes(o.status||"")};m.push(d),p++}for(;m.length>0&&m.length<7;)m.push({dayOfMonth:null});m.length>0&&u.push(m),b(u),j(!1)},[g,t,a,h,x,N]);let v=e=>{switch(e){case"Present":return"bg-green-200 text-green-800";case"Late":return"bg-yellow-200 text-yellow-800";case"Absent":return"bg-red-200 text-red-800";case"Permission":return"bg-purple-200 text-purple-800";case"Pending":return"bg-blue-100 text-blue-700";case"Absent (Config Missing)":return"bg-orange-100 text-orange-700";case"Not Applicable (Holiday/Weekend)":return"text-gray-400";case"Not Yet Enrolled":return"text-gray-400 dark:text-slate-500";case"Unknown":return"bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-200";default:return"text-transparent"}},S=(0,s.useMemo)(()=>{if(N){let[e,t]=N.split("-");if(e&&t)return new Date(parseInt(e),parseInt(t)-1,1).toLocaleString("default",{month:"long",year:"numeric"})}return"Details"},[N]),{isPrevDisabled:A,isNextDisabled:D}=(0,s.useMemo)(()=>{let e=new Date,a=e.getFullYear(),l=e.getMonth(),[s,n]=N.split("-").map(Number),i=n-1,c=!1;if(t.createdAt){let e=t.createdAt instanceof r.Dc?t.createdAt.toDate():t.createdAt,a=e.getFullYear(),l=e.getMonth();(s<a||s===a&&i<=l)&&(c=!0)}else s<a-2&&(c=!0);return{isPrevDisabled:c,isNextDisabled:s>a||s===a&&i>=l}},[N,t.createdAt]);return(0,l.jsxs)(n.A,{title:"Attendance: ".concat(t.fullName),isActive:g,onConfirm:m,buttonLabel:"Close",buttonColor:"info",modalClassName:"w-11/12 md:w-4/5 lg:w-3/5 xl:max-w-4xl",children:[(0,l.jsxs)("div",{className:"mb-4 flex justify-between items-center px-2 sm:px-4 py-2 border-b dark:border-slate-700",children:[(0,l.jsx)(o.A,{icon:d.LyG,onClick:()=>w("prev"),small:!0,outline:!0,color:"lightDark","aria-label":"Previous Month",disabled:A}),(0,l.jsx)("h3",{className:"text-md sm:text-lg font-semibold text-gray-700 dark:text-gray-200",children:S}),(0,l.jsx)(o.A,{icon:d.mI8,onClick:()=>w("next"),small:!0,outline:!0,color:"lightDark","aria-label":"Next Month",disabled:D})]}),y?(0,l.jsx)("p",{className:"p-4 text-center",children:"Loading details..."}):0===f.length?(0,l.jsx)("p",{className:"p-4 text-center",children:"No attendance details to display."}):(0,l.jsx)("div",{className:"text-sm p-1 md:p-2",children:(0,l.jsxs)("table",{className:"w-full table-fixed border-collapse text-center",children:[(0,l.jsx)("thead",{children:(0,l.jsx)("tr",{children:u.map(e=>(0,l.jsx)("th",{className:"py-2 px-1 border dark:border-slate-700 font-semibold text-xs text-center",children:e},e))})}),(0,l.jsx)("tbody",{children:f.map((e,t)=>(0,l.jsx)("tr",{children:e.map((e,t)=>(0,l.jsx)("td",{className:"py-1 px-1 border dark:border-slate-700 h-16 md:h-20 relative align-top text-left transition-colors duration-150 ease-in-out\n                      ".concat(e.isToday?"bg-sky-100 dark:bg-sky-700/60":!e.isSchoolDayCell&&e.dayOfMonth?"bg-gray-100 dark:bg-slate-800 opacity-70":e.dayOfMonth&&e.isPast?"bg-white dark:bg-slate-700/50":e.dayOfMonth&&!e.isPast?"bg-slate-50 dark:bg-slate-800/80":"bg-gray-50 dark:bg-slate-900"),children:e.dayOfMonth&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"absolute top-1 left-1 text-s p-0.5 \n                            ".concat(e.isToday?"font-bold text-sky-600 dark:text-sky-200":e.isPast||e.status?"text-gray-800 dark:text-gray-100 font-medium":"text-gray-400 dark:text-slate-500"),children:e.dayOfMonth}),(0,l.jsxs)("div",{className:"absolute inset-0 top-5 md:top-6 flex flex-col items-center justify-start pt-1 px-0.5 text-center",children:[e.status&&["Present","Late","Absent","Pending","Permission","Absent (Config Missing)","Unknown"].includes(e.status)&&(0,l.jsx)("span",{className:"px-1.5 py-0.5 text-xs sm:text-xs rounded-full leading-tight whitespace-nowrap font-semibold ".concat(v(e.status)),children:"Absent (Config Missing)"===e.status?"Absent*":e.status}),("Present"===e.status||"Late"===e.status)&&e.time&&(0,l.jsx)("span",{className:"block text-xxs mt-0.5 pt-1 leading-tight ".concat(e.isToday?"text-sky-700 dark:text-sky-200":"text-gray-500 dark:text-gray-400"),children:e.time?"(".concat(e.time,")"):""}),("Not Applicable (Holiday/Weekend)"===e.status||"Not Yet Enrolled"===e.status)&&(0,l.jsx)("span",{className:"text-xxs leading-tight opacity-70 ".concat(v(e.status)," ").concat(e.isToday?"font-medium":""),children:"Not Applicable (Holiday/Weekend)"===e.status?"Non-School":"Not Enrolled"})]})]})},t))},t))})]})})]})}},8928:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var l=a(5155),s=a(2115),r=a(1063),n=a(5632),i=a(198),c=a(4713),o=a(657),d=a(2079),u=a(3061),h=a(2781);let x=e=>{let{options:t,selectedValues:a,onChange:n,placeholder:i="Select options...",buttonClassName:c,fieldData:o,id:d}=e,[u,x]=(0,s.useState)(!1),[g,m]=(0,s.useState)(""),p=(0,s.useRef)(null),f=(0,s.useRef)(null),b=(0,s.useMemo)(()=>g.trim()?t.filter(e=>e.label.toLowerCase().includes(g.toLowerCase())):t,[t,g]),y=e=>{n(a.includes(e)?a.filter(t=>t!==e):[...a,e])};(0,s.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&x(!1)};return u?(document.addEventListener("mousedown",e),setTimeout(()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.focus()},0)):m(""),()=>{document.removeEventListener("mousedown",e)}},[u]);let j=(null==o?void 0:o.className)?"".concat(o.className.replace("px-3 py-2","px-3 py-2.5")," text-left inline-flex items-center justify-between ").concat(c||""):"".concat("text-black relative w-full bg-white border border-gray-300 hover:border-gray-400 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-lg text-sm px-3 py-2.5 text-left inline-flex items-center justify-between shadow-sm dark:bg-slate-800 dark:border-gray-600 dark:text-white dark:focus:ring-indigo-500"," ").concat(c||""),N=b.length>0&&b.every(e=>a.includes(e.value));return(0,l.jsxs)("div",{className:"relative w-full",ref:p,children:[(0,l.jsxs)("button",{type:"button",id:d,onClick:()=>x(!u),className:j,"aria-haspopup":"listbox","aria-expanded":u,children:[(0,l.jsx)("span",{className:"truncate",children:0===a.length?i:t.length>0&&a.length===t.length?"All Selected (".concat(t.length,")"):a.length<=2?a.map(e=>{var a;return null===(a=t.find(t=>t.value===e))||void 0===a?void 0:a.label}).filter(Boolean).join(", "):"".concat(a.length," items selected")}),(0,l.jsx)(h.A,{path:r.W5x,w:"h-5 w-5",className:"ml-2 transform transition-transform duration-200 ".concat(u?"rotate-180":"")})]}),u&&(0,l.jsxs)("div",{className:"z-20 absolute mt-1 w-full bg-white rounded-lg shadow-xl dark:bg-gray-700 border border-gray-200 dark:border-gray-600 max-h-72 flex flex-col",children:[(0,l.jsx)("div",{className:"p-2 border-b border-gray-200 dark:border-gray-600 sticky top-0 bg-white dark:bg-gray-700",children:(0,l.jsx)("input",{ref:f,type:"text",placeholder:"Search options...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-500 dark:text-white focus:ring-indigo-500 focus:border-indigo-500",value:g,onChange:e=>m(e.target.value),onClick:e=>e.stopPropagation()})}),(0,l.jsxs)("ul",{className:"flex-grow overflow-y-auto py-1",role:"listbox",children:[b.length>0&&(0,l.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,l.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,l.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",checked:N,onChange:()=>{let e=b.map(e=>e.value),t=e.length>0&&e.every(e=>a.includes(e)),l=[...a];t?l=l.filter(t=>!e.includes(t)):e.forEach(e=>{l.includes(e)||l.push(e)}),n(l)}}),(0,l.jsxs)("span",{children:[N?"Deselect All Shown":"Select All Shown"," (",b.length,")"]})]})}),b.map(e=>(0,l.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,l.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,l.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",value:e.value,checked:a.includes(e.value),onChange:()=>y(e.value)}),(0,l.jsx)("span",{children:e.label})]})},e.value)),t.length>0&&0===b.length&&g&&(0,l.jsxs)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:["No options match",g]}),0===t.length&&(0,l.jsx)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No options available"})]})]})]})};var g=a(7058),m=a(7738);let p=e=>{let t;if(!e)return"N/A";if("string"==typeof e){let a=e.split("-");t=3!==a.length||isNaN(parseInt(a[0]))||isNaN(parseInt(a[1]))||isNaN(parseInt(a[2]))?new Date(e):new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]))}else if(e instanceof g.Dc)t=e.toDate();else{if(!(e instanceof Date))return"Invalid Date Type";t=e}if(isNaN(t.getTime()))return"Invalid Date";let a=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();return"".concat(a,"-").concat(l,"-").concat(s)},f=e=>{let{statuses:t,perPage:a=10,onViewDetails:n}=e,[i,c]=(0,s.useState)(0),o=t.slice(a*i,a*(i+1)),u=Math.ceil(t.length/a),h=[];for(let e=0;e<u;e++)h.push(e);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Student Name"}),(0,l.jsx)("th",{children:"Class"}),(0,l.jsx)("th",{children:"Shift"}),(0,l.jsx)("th",{children:"Date"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"Time"}),(0,l.jsx)("th",{children:"Details"})]})}),(0,l.jsx)("tbody",{children:o.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{"data-label":"Student Name",children:e.fullName}),(0,l.jsx)("td",{"data-label":"Class",children:e.class||"N/A"}),(0,l.jsx)("td",{"data-label":"Shift",children:e.shift||"N/A"}),(0,l.jsx)("td",{"data-label":"Date",className:"whitespace-nowrap",children:p(e.attendanceDate)}),(0,l.jsx)("td",{"data-label":"Status",children:(0,l.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("Present"===e.attendanceStatus?"bg-green-200 text-green-800":"Late"===e.attendanceStatus?"bg-yellow-100 text-yellow-800 border border-yellow-300":"Absent"===e.attendanceStatus?"bg-red-200 text-red-800":"Pending"===e.attendanceStatus?"bg-blue-200 text-blue-800":"Permission"===e.attendanceStatus?"bg-purple-200 text-purple-800":"bg-gray-100 text-gray-800"),children:e.attendanceStatus})}),(0,l.jsx)("td",{"data-label":"Time",className:"whitespace-nowrap",children:("Present"===e.attendanceStatus||"Late"===e.attendanceStatus)&&e.actualTimestamp?e.actualTimestamp instanceof g.Dc?e.actualTimestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):e.actualTimestamp instanceof Date?e.actualTimestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A"}),(0,l.jsxs)("td",{className:"before:hidden lg:w-1 whitespace-nowrap text-center",children:[" ",(0,l.jsx)(d.A,{icon:r.WCY,onClick:()=>n(e),color:"info",small:!0,outline:!0})]})]},e.id))})]})}),(0,l.jsx)("div",{className:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800",children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between py-3 md:py-0",children:[(0,l.jsx)(m.A,{children:h.map(e=>(0,l.jsx)(d.A,{active:e===i,label:(e+1).toString(),color:e===i?"lightDark":"whiteDark",small:!0,onClick:()=>c(e),isGrouped:!0},e))}),(0,l.jsxs)("small",{className:"mt-6 md:mt-0",children:["Page ",i+1," of ",u," (Total: ",t.length," records)"]})]})})]})};var b=a(9496),y=a(5111),j=a(8449),N=a(9532);let k=()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)};function w(){let[e,t]=(0,s.useState)(k()),[a,h]=(0,s.useState)([]),[m,p]=(0,s.useState)([]),[w,v]=(0,s.useState)(""),[S,A]=(0,s.useState)([]),[D,C]=(0,s.useState)(null),[M,P]=(0,s.useState)([]),[T,E]=(0,s.useState)([]),[F,I]=(0,s.useState)([]),[L,G]=(0,s.useState)(!1),[Y,_]=(0,s.useState)(!0),[O,W]=(0,s.useState)(null),[H,z]=(0,s.useState)(!1),[J,U]=(0,s.useState)(null),R=["Morning","Afternoon","Evening"].map(e=>({value:e,label:e})),V=(0,s.useCallback)((e,t)=>{W(t),setTimeout(()=>W(null),5e3)},[]);(0,s.useEffect)(()=>{(async()=>{_(!0);try{let e=(0,g.rJ)(y.db,"classes"),t=(0,g.P)(e,(0,g.My)("name")),a=await (0,g.GG)(t),l=[],s={};a.docs.forEach(e=>{let t=e.data();l.push({value:t.name,label:t.name}),s[e.id]=t}),A(l),C(s)}catch(e){console.error("Error fetching initial class data:",e),V("error","Failed to load class list.")}_(!1)})()},[V]);let B=(0,s.useCallback)(async()=>{if(G(!0),W(null),I([]),P([]),E([]),!e){V("error","Please select a date."),G(!1);return}if(0===a.length&&0===m.length){V("info","Please select at least one class or shift to generate a report."),G(!1);return}try{let t=(0,g.rJ)(y.db,"students"),l=(0,g.rJ)(y.db,"attendance"),s=(0,g.rJ)(y.db,"permissions"),r=[];a.length>0?r.push((0,g._M)("class","in",a)):r.push((0,g._M)("shift","in",m));let n=(0,g.P)(t,...r),i=(await (0,g.GG)(n)).docs.map(e=>({id:e.id,...e.data()})),c=a.length>0&&m.length>0?i.filter(e=>e.shift&&m.includes(e.shift)):i;if(0===c.length){V("info","No students match the selected criteria."),I([]),G(!1);return}let o=c.map(e=>e.id),d=[],u=[];if(o.length>0){let e=new Date;e.setDate(e.getDate()-60);let t="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")),a=[],r=[];for(let e=0;e<o.length;e+=30){let n=o.slice(e,e+30),i=(0,g.P)(l,(0,g._M)("studentId","in",n),(0,g._M)("date",">=",t)),c=(0,g.P)(s,(0,g._M)("studentId","in",n),(0,g._M)("status","==","approved"));a.push((0,g.GG)(i)),r.push((0,g.GG)(c))}let[n,i]=await Promise.all([Promise.all(a),Promise.all(r)]);n.flat().forEach(e=>e.docs.forEach(e=>{d.push({id:e.id,studentId:e.data().studentId,...e.data()})})),P(d),i.flat().forEach(e=>e.docs.forEach(e=>{u.push({id:e.id,...e.data()})})),E(u)}let h=new Map;d.filter(t=>t.date===e).forEach(e=>h.set(e.studentId,e));let x=c.map(t=>{let a=h.get(t.id),l=u.filter(e=>e.studentId===t.id),s=(0,N.tE)(t,e,a,D,l);return{...t,attendanceDate:e,attendanceStatus:s.status,actualTimestamp:null==a?void 0:a.timestamp}}),p=""!==w.trim()?x.filter(e=>e.fullName.toLowerCase().includes(w.toLowerCase())):x;I(p)}catch(e){console.error("Error fetching data:",e),e instanceof Error&&"code"in e?"failed-precondition"===e.code&&e.message.includes("index")?W("Query requires a new index. Please check the browser console for a link to create it."):W("Failed to fetch data. Please try again."):W("An unknown error occurred.")}G(!1)},[e,a,m,w,V,D]),Z=(0,s.useCallback)(e=>{U(e),z(!0)},[]),q=a=>{let l=e.split("-").map(e=>parseInt(e,10)),s=new Date(l[0],l[1]-1,l[2]);s.setDate(s.getDate()+a);let r=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");t("".concat(r,"-").concat(n,"-").concat(i))};return(0,s.useEffect)(()=>{a.length>0||m.length>0?B():(I([]),P([]),E([]))},[e,a,m,B]),(0,l.jsxs)(n.A,{children:[(0,l.jsx)(i.A,{icon:r.U4M,title:"Check Daily Attendance Status",main:!0}),(0,l.jsxs)(c.A,{className:"mb-6 px-4 pt-2 pb-4 rounded-lg shadow",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-4 items-start",children:[(0,l.jsx)(u.A,{label:"Date",labelFor:"checkDate",children:a=>(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(d.A,{icon:r.LyG,onClick:()=>q(-1),color:"lightDark",small:!0,outline:!0}),(0,l.jsx)("input",{type:"date",id:"checkDate",value:e,onChange:e=>t(e.target.value),className:"".concat(a.className," flex-grow")}),(0,l.jsx)(d.A,{icon:r.mI8,onClick:()=>q(1),color:"lightDark",small:!0,outline:!0})]})}),(0,l.jsx)(u.A,{label:"Class",labelFor:"checkClassMulti",children:e=>(0,l.jsx)(x,{id:"checkClassMulti",options:S,selectedValues:a,onChange:h,placeholder:Y?"Loading classes...":0===S.length?"No classes available":"Select Class",fieldData:e})}),(0,l.jsx)(u.A,{label:"Shift",labelFor:"checkShiftMulti",children:e=>(0,l.jsx)(x,{id:"checkShiftMulti",options:R,selectedValues:m,onChange:p,placeholder:"Select Shift",fieldData:e})}),(0,l.jsx)(u.A,{label:"Student Name (Filter)",labelFor:"checkName",children:e=>(0,l.jsx)("input",{type:"text",id:"checkName",placeholder:"Search by name...",value:w,onChange:e=>v(e.target.value),className:e.className})})]}),(0,l.jsx)("div",{className:"flex justify-start",children:(0,l.jsx)(d.A,{label:"Check Status",color:"info",icon:r.U4M,onClick:()=>{B()},disabled:L||!e||0===a.length&&0===m.length})})]}),O&&(0,l.jsx)(o.A,{color:"danger",icon:r.tPJ,className:"mb-4",children:O}),(0,l.jsx)(c.A,{className:"mb-6 rounded-lg shadow",hasTable:!0,children:L?(0,l.jsx)("p",{className:"p-6 text-center",children:"Loading student statuses..."}):F.length>0?(0,l.jsx)(f,{statuses:F,onViewDetails:Z}):e&&(a.length>0||m.length>0)&&!O?(0,l.jsx)(o.A,{color:"info",icon:r.U4M,children:"No students found for the selected criteria."}):(0,l.jsx)(o.A,{color:"info",children:"Please select a date and at least one class or shift to get a report."})}),H&&J&&D&&(0,l.jsx)(b.A,{student:J,attendanceRecords:M.filter(e=>e.studentId===J.id),approvedPermissions:T.filter(e=>e.studentId===J.id),allClassConfigs:D,isActive:H,onClose:()=>{z(!1),U(null)},initialMonthValue:(0,j.AZ)(new Date(e))})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,992,965,164,173,84,441,517,358],()=>t(5730)),_N_E=e.O()}]);