(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{2279:(e,t,s)=>{Promise.resolve().then(s.bind(s,2709))},7738:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);let r=e=>{let{type:t="justify-start",mb:s="-mb-3",noWrap:r=!1,children:l,className:n}=e;return(0,a.jsxs)("div",{className:"flex items-center ".concat(t," ").concat(n," ").concat(s," ").concat(r?"flex-nowrap":"flex-wrap"),children:[l," "]})}},1315:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);s(2115);let r=e=>{let{title:t,children:s}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3 pl-4",children:[(0,a.jsx)("h1",{className:"text-2xl",children:t}),s]})}},6706:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var a=s(5155),r=s(1063),l=s(2079),n=s(7738),o=s(4713),i=s(1315),c=s(9912);let d=e=>{let{title:t,buttonColor:s,buttonLabel:d,isActive:u,children:m,modalClassName:x="w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12",onConfirm:h,onCancel:p}=e;if(!u)return null;let f=h&&d&&s?(0,a.jsxs)(n.A,{type:"justify-end",children:[(0,a.jsx)(l.A,{label:d,color:s,onClick:h,isGrouped:!0}),!!p&&(0,a.jsx)(l.A,{label:"Cancel",color:s,outline:!0,onClick:p,isGrouped:!0})]}):null;return(0,a.jsx)(c.A,{onClick:p,className:p?"cursor-pointer":"",children:(0,a.jsxs)(o.A,{className:"transition-transform shadow-lg max-h-modal ".concat(x," z-50"),isModal:!0,footer:f,children:[(0,a.jsx)(i.A,{title:t,children:!!p&&(0,a.jsx)(l.A,{icon:r.hyP,color:"whiteDark",onClick:p,small:!0,roundedFull:!0})}),(0,a.jsx)("div",{className:"space-y-3 pl-4",children:m})]})})}},3061:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(5155),r=s(2781);let l=e=>{var t;let{htmlFor:s,children:r,...l}=e;return(0,a.jsx)("label",{htmlFor:s,className:"block mb-2 font-semibold ".concat(s?"cursor-pointer":""," ").concat(null!==(t=l.className)&&void 0!==t?t:""),children:(0,a.jsx)("span",{className:"line-clamp-1",children:r})})},n=e=>{let{children:t,...s}=e,n={className:["px-3 py-2 max-w-full border-gray-700 rounded-sm w-full dark:placeholder-gray-400","focus:ring-3 focus:ring-blue-600 focus:border-blue-600 focus:outline-hidden",s.hasTextareaHeight?"h-24":"h-12",s.isBorderless?"border-0":"border",s.isTransparent?"bg-transparent":"bg-white dark:bg-slate-800",s.icon?"pl-10":""].join(" ")};return(0,a.jsxs)("div",{className:"mb-2 last:mb-0",children:[s.label&&(0,a.jsx)(l,{htmlFor:s.labelFor,children:s.label}),(0,a.jsxs)("div",{className:"relative",children:[t(n),s.icon&&(0,a.jsx)(r.A,{path:s.icon,w:"w-10",h:s.hasTextareaHeight?"h-full":"h-12",className:"absolute top-0 left-0 z-10 pointer-events-none text-gray-500 dark:text-slate-400"})]}),s.help&&(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:s.help})]})}},683:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(e){let{className:t="",width:s,height:r}=e,l={},n="m-2 ".concat(t);return void 0!==s&&void 0!==r?(l.width="".concat(s,"px"),l.height="".concat(r,"px")):n="w-12 h-12 m-2 ".concat(t),(0,a.jsx)("img",{src:"/rodwell_logo.png",alt:"Rodwell Logo",className:n,style:l,draggable:!1})}s(2115)},9912:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(e){let{zIndex:t="z-50",type:s="flex",children:r,className:l,...n}=e;return(0,a.jsxs)("div",{className:"".concat(s," ").concat(t," ").concat(l," items-center flex-col justify-center overflow-hidden fixed inset-0"),children:[(0,a.jsx)("div",{className:"overlay absolute inset-0 bg-linear-to-tr opacity-90 dark:from-gray-700 dark:via-gray-900 dark:to-gray-700",onClick:e=>{e.preventDefault(),n.onClick&&n.onClick(e)}}),r]})}s(2115)},8299:(e,t,s)=>{"use strict";s.d(t,{G:()=>l,j:()=>r});var a=s(3391);let r=a.wA,l=a.d4},2709:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var a=s(5155),r=s(2115),l=s(7711),n=s(5565);let o={"No Registered":{percent:0,message:"Not registered yet!",color:"text-red-500",bar:"bg-red-500"},Registered:{percent:33,message:"Registered for Mock Exam",color:"text-orange-400",bar:"bg-orange-400"},Borrow:{percent:66,message:"You owe Star payment. You need to finish your payment to view your Mock 3 results.",color:"text-blue-500",bar:"bg-blue-500"},"Paid Star":{percent:100,message:"Star has been Paid! Good Luck on the Exam.",color:"text-green-500",bar:"bg-green-500"}};function i(e){let{status:t,loading:s}=e,[l,n]=(0,r.useState)(0),i=o[t]||o["No Registered"];if((0,r.useEffect)(()=>{if(!s){let e=setTimeout(()=>{n(i.percent)},100);return()=>clearTimeout(e)}},[s,i.percent]),s)return(0,a.jsxs)("div",{className:"bg-slate-900 rounded-2xl px-6 pt-4 pb-6 max-w-2xl mx-auto my-6 animate-pulse",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Mock Exam 3"}),(0,a.jsx)("span",{className:"text-sm text-gray-400 font-semibold",children:"Your progress"})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"h-8 w-3/4 bg-slate-700 rounded"})}),(0,a.jsx)("div",{className:"relative h-2 bg-slate-700 rounded-full"})]});let c=Object.keys(o).indexOf(t);return(0,a.jsxs)("div",{className:"bg-slate-900 rounded-2xl px-6 pt-4 pb-6 max-w-2xl mx-auto my-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Mock Exam 3"}),(0,a.jsx)("span",{className:"text-sm text-gray-400 font-semibold",children:"Your progress"})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("span",{className:"text-2xl font-bold ".concat(i.color),children:i.message})}),(0,a.jsxs)("div",{className:"relative h-2 bg-slate-700 rounded-full",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-700 ease-out ".concat(i.bar),style:{width:"".concat(l,"%")}}),(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-between",children:Object.keys(o).map((e,t)=>(0,a.jsxs)("div",{className:"relative flex justify-center group",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full transition-colors duration-500 ".concat(t<=c?i.bar:"bg-slate-600")}),(0,a.jsxs)("div",{className:"absolute bottom-full mb-2 w-max px-3 py-1.5 bg-gray-800 text-white text-xs font-semibold rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity duration-300 pointer-events-none",children:["".concat(t+1,". ").concat(e),(0,a.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2 top-full w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-800"})]})]},e))})]})]})}let c=e=>{let{tabs:t,selectedTab:s,setSelectedTab:r,disabled:l=!1}=e,n=e=>{if(e&&e.startsWith("mock")){let t=e.substring(4);return"Mock ".concat(t)}return e?e.charAt(0).toUpperCase()+e.slice(1):""};return(0,a.jsx)("div",{className:"mb-6 border-b-2 border-slate-700",children:(0,a.jsx)("nav",{className:"-mb-0.5 flex space-x-6",children:t.map(e=>(0,a.jsx)("button",{onClick:()=>r(e),disabled:l,className:"py-4 px-1 inline-flex items-center gap-2 text-sm font-medium transition-all\n              ".concat(s===e?"border-b-2 border-purple-500 text-purple-400":"border-b-2 border-transparent text-gray-400 hover:text-purple-400","\n              ").concat(l?"cursor-not-allowed opacity-50":"","\n            "),children:n(e)},e))})})},d=e=>{let{percentage:t}=e,[s,l]=(0,r.useState)(0);(0,r.useEffect)(()=>{l(0);let e=setTimeout(()=>{l(t)},150);return()=>clearTimeout(e)},[t]);let n=90*Math.PI,o=Math.max(0,Math.min(100,s));return(0,a.jsx)("div",{className:"relative w-40 h-40 sm:w-44 sm:h-44",children:(0,a.jsxs)("svg",{height:"100%",width:"100%",viewBox:"0 0 120 120",className:"-rotate-90",children:[(0,a.jsx)("circle",{stroke:"#334155",fill:"transparent",strokeWidth:10,r:50,cx:"60",cy:"60"}),(0,a.jsx)("circle",{stroke:"#8B5CF6",fill:"transparent",strokeWidth:10,strokeDasharray:n+" "+n,style:{strokeDashoffset:n-o/100*n},className:"transition-[stroke-dashoffset] duration-1000 ease-out",r:50,cx:"60",cy:"60",strokeLinecap:"round"})]})})},u=e=>{let{subject:t,score:s,maxScore:r,grade:l}=e;return(0,a.jsxs)("div",{className:"bg-slate-900 px-4 py-2 rounded-lg flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-white leading-tight",children:(e=>"string"!=typeof e||0===e.length?"":e.charAt(0).toUpperCase()+e.slice(1))(t)}),(0,a.jsxs)("div",{className:"flex items-baseline gap-x-2 mt-1",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Score:"}),(0,a.jsx)("span",{className:"text-xl font-bold text-white",children:s}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["/ ",r]})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-slate-800 border-2 border-slate-700",children:(0,a.jsx)("span",{className:"text-3xl font-bold ".concat((e=>{switch(e){case"A":return"text-green-400";case"B":return"text-emerald-400";case"C":return"text-sky-400";case"D":return"text-yellow-400";case"E":return"text-orange-400";default:return"text-red-500"}})(l)),children:l})})]})};var m=s(5111),x=s(7058),h=s(9532),p=s(8299),f=s(6706),g=s(2079),b=s(3061),y=s(4187),j=s(9938),v=s(2781),w=s(1063);let N=e=>{let{options:t,selectedValue:s,onChange:l,placeholder:n="Select an option...",id:o,fieldData:i}=e,[c,d]=(0,r.useState)(!1),u=(0,r.useRef)(null),m=(0,r.useRef)(null),x=s&&!t.some(e=>e.value===s),h=e=>{l(e),d(!1)};(0,r.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&d(!1)};return c&&(document.addEventListener("mousedown",e),x&&setTimeout(()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.focus()},0)),()=>{document.removeEventListener("mousedown",e)}},[c,x]);let p=(null==i?void 0:i.className)?"".concat(i.className.replace("px-3 py-2","px-3 py-2.5")," text-left inline-flex items-center justify-between"):"text-black relative w-full bg-white border border-gray-300 hover:border-gray-400 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-lg text-sm px-3 py-2.5 text-left inline-flex items-center justify-between shadow-sm dark:bg-slate-800 dark:border-gray-600 dark:text-white dark:focus:ring-indigo-500";return(0,a.jsxs)("div",{className:"relative w-full",ref:u,children:[(0,a.jsxs)("button",{type:"button",id:o,onClick:()=>d(!c),className:p,"aria-haspopup":"listbox","aria-expanded":c,children:[(0,a.jsx)("span",{className:"truncate",children:(()=>{if(!s)return n;let e=t.find(e=>e.value===s);return e?e.label:s})()}),(0,a.jsx)(v.A,{path:w.W5x,w:"h-5 w-5",className:"ml-2 transform transition-transform duration-200 ".concat(c?"rotate-180":"")})]}),c&&(0,a.jsx)("div",{className:"z-20 absolute mt-1 w-full bg-white rounded-lg shadow-xl dark:bg-gray-700 border border-gray-200 dark:border-gray-600 max-h-72 flex flex-col",children:(0,a.jsxs)("ul",{className:"flex-grow overflow-y-auto py-1",role:"listbox",children:[t.map(e=>(0,a.jsx)("li",{className:"px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer text-sm text-gray-900 dark:text-gray-100",onClick:()=>h(e.value),children:e.label},e.value)),(0,a.jsx)("li",{className:"p-2 border-t border-gray-200 dark:border-gray-600 sticky bottom-0 bg-white dark:bg-gray-700",children:(0,a.jsx)("input",{ref:m,type:"text",placeholder:"Other reason...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-500 dark:text-white focus:ring-indigo-500 focus:border-indigo-500",value:x?s:"",onChange:e=>{l(e.target.value)},onClick:e=>e.stopPropagation()})})]})})]})},k=e=>{let{onSuccess:t}=e,[s,l]=(0,r.useState)({message:"",type:""}),n=(0,p.G)(e=>e.main.studentDocId),o=(0,p.G)(e=>e.main.userUid),i=(0,p.G)(e=>e.main.userName),c=[{value:"Sickness",label:"Sickness"},{value:"Family Event",label:"Family Event"},{value:"Appointment",label:"Appointment"}],d=j.Ik().shape({permissionStartDate:j.p6().required("Start date is required"),duration:j.ai().min(1,"Duration must be at least 1 day").required("Duration is required"),reason:j.Yj().required("Please select or specify a reason"),details:j.Yj().required("Details are required").test("min-words","Details must be at least 10 words long",e=>(e||"").split(/\s+/).filter(Boolean).length>=10)}),u=async(e,s)=>{let{setSubmitting:a,resetForm:r}=s;if(l({message:"",type:""}),!n||!o){l({message:"Error: User not authenticated properly.",type:"error"}),a(!1);return}let{permissionStartDate:c,duration:d,reason:u,details:h}=e,p=new Date(c),f=new Date(p);f.setDate(p.getDate()+d-1);let g={studentId:n,authUid:o,studentName:i,reason:u,details:h,permissionStartDate:p.toISOString().split("T")[0],permissionEndDate:f.toISOString().split("T")[0],duration:d,status:"pending",requestDate:(0,x.O5)()};console.log("Submitting to Firestore:",g);try{await (0,x.gS)((0,x.rJ)(m.db,"permissions"),g),l({message:"Your request has been submitted successfully!",type:"success"}),r({values:{permissionStartDate:"",duration:1,reason:"",details:""}}),t&&setTimeout(t,1500)}catch(e){console.error("Error submitting permission request:",e),l({message:"An error occurred while submitting your request. Please try again.",type:"error"})}a(!1)};return(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg mr-3 mb-4",children:[(0,a.jsx)(y.l1,{initialValues:{permissionStartDate:"",duration:1,reason:"",details:""},validationSchema:d,onSubmit:u,children:e=>{let{values:t,isSubmitting:s,setFieldValue:r}=e;return(0,a.jsxs)(y.lV,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(b.A,{label:"Start Date",labelFor:"permissionStartDate",children:e=>(0,a.jsx)(y.D0,{id:"permissionStartDate",name:"permissionStartDate",type:"date",...e})}),(0,a.jsx)(b.A,{label:"Duration (days)",labelFor:"duration",children:e=>(0,a.jsx)(y.D0,{id:"duration",name:"duration",type:"number",min:"1",...e})}),(0,a.jsx)(b.A,{label:"Reason",labelFor:"reason",children:e=>(0,a.jsx)(N,{options:c,selectedValue:t.reason,onChange:e=>r("reason",e),fieldData:e,id:"reason"})}),(0,a.jsx)(b.A,{label:"Details (min. 10 words)",labelFor:"details",hasTextareaHeight:!0,children:e=>(0,a.jsx)(y.D0,{id:"details",name:"details",as:"textarea",...e,placeholder:"Please provide specific details about your absence..."})})]}),(0,a.jsx)(y.Kw,{name:"details",component:"div",className:"text-red-500 text-sm mt-1"}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(g.A,{type:"submit",color:"info",label:s?"Submitting...":"Submit Request",disabled:s})})]})}}),s.message&&(0,a.jsx)("div",{className:"mt-6 text-sm p-4 rounded-lg text-center ".concat("success"===s.type?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-700"),children:s.message})]})};var S=s(3084),E=s(683),P=s(4748);let A=e=>{let{studentName:t,studentUid:s,qrSize:l=200}=e,[n,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(60),[f,b]=(0,r.useState)(null),y=Math.floor(.25*l),j=async()=>{c(!0),u(null),o(null),b(null);try{let e=(0,P.Uz)(m.yA,"asia-southeast1"),t=(0,P.Qg)(e,"generateAttendancePasscode"),s=await t();o(s.data.passcode),p(60)}catch(e){console.error("Error generating token:",e),u(e.message||"Could not generate QR Code.")}finally{c(!1)}};return((0,r.useEffect)(()=>{if(!n||h<=0){n&&o(null);return}let e=setInterval(()=>{p(e=>e-1)},1e3);return()=>clearInterval(e)},[n,h]),(0,r.useEffect)(()=>{let e;if(n){let t=async()=>{try{let e=new Date().toISOString().split("T")[0],t=(0,x.rJ)(m.db,"attendance"),a=(0,x.P)(t,(0,x._M)("date","==",e),(0,x._M)("authUid","==",s)),r=await (0,x.GG)(a);if(!r.empty){let e=r.docs[0].data();return b(e.status),o(null),!0}return!1}catch(e){return console.error("Error fetching attendance status:",e),u("Failed to fetch attendance status."),!1}};t().then(s=>{s||(e=setInterval(async()=>{await t()&&clearInterval(e)},2e3))})}return()=>{e&&clearInterval(e)}},[n,s]),(0,r.useEffect)(()=>{(async()=>{try{let e=new Date().toISOString().split("T")[0],t=(0,x.rJ)(m.db,"attendance"),a=(0,x.P)(t,(0,x._M)("date","==",e),(0,x._M)("authUid","==",s)),r=await (0,x.GG)(a);if(!r.empty){let e=r.docs[0].data();b(e.status)}}catch(e){}})()},[s]),f)?(0,a.jsxs)("div",{className:"text-center p-8 rounded-lg ".concat("present"===f?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:[(0,a.jsx)("p",{className:"text-lg font-bold",children:"present"===f?"Present!":"Late!"}),(0,a.jsxs)("p",{className:"mt-2",children:[t," is marked ",f,"."]})]}):n?(0,a.jsxs)("div",{className:"inline-block rounded-xl overflow-hidden shadow-lg bg-white",children:[(0,a.jsx)("div",{className:"bg-purple-800 p-2 text-center",children:t&&(0,a.jsx)("h3",{className:"text-lg font-bold text-white truncate",title:t,children:t})}),(0,a.jsxs)("div",{className:"bg-white p-2 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"rounded-lg shadow-inner bg-white p-2",style:{position:"relative",width:l,height:l},children:[(0,a.jsx)(S.h,{value:n,size:l-16,bgColor:"#ffffff",fgColor:"#000000",level:"H",style:{display:"block",width:"100%",height:"100%"}}),(0,a.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",padding:"4px",borderRadius:"6px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",width:y,height:y},children:(0,a.jsx)(E.A,{width:y-8,height:y-8})})]}),(0,a.jsxs)("p",{className:"mt-2 font-mono text-sm text-gray-700",children:["Code expires in: ",(0,a.jsx)("span",{className:"font-bold",children:h}),"s"]})]})]}):(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("p",{className:"mb-4 text-gray-600 dark:text-gray-400",children:"Click the button to generate a temporary QR code for attendance."}),(0,a.jsx)(g.A,{label:i?"Generating...":"Generate Secure QR Code",onClick:j,color:"info",disabled:i}),d&&(0,a.jsx)("p",{className:"text-red-500 mt-4",children:d})]})},D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[a,l]=(0,r.useState)(0),n=Math.round(t/(1e3/60)),o=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t=0;l(0);let s=()=>{var a;l(Math.round(e*(1==(a=++t/n)?1:1-Math.pow(2,-10*a)))),t<n&&(o.current=requestAnimationFrame(s))};return o.current=requestAnimationFrame(s),()=>{o.current&&cancelAnimationFrame(o.current)}},[e,t,n,...s]),a},C=(0,l.default)(()=>Promise.all([s.e(943),s.e(878)]).then(s.bind(s,1878)),{loadableGenerated:{webpack:()=>[1878]},ssr:!1,loading:()=>(0,a.jsx)("p",{className:"text-lg text-center p-12",children:"Loading Portal..."})}),M=()=>{let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),o=r.useRef(null),g=(0,p.G)(e=>e.main.userName),b=(0,p.G)(e=>e.main.userUid),y=(0,p.G)(e=>e.main.studentDocId),[j,v]=(0,r.useState)("No Registered"),[w,N]=(0,r.useState)(null),[S,E]=(0,r.useState)(null),[P,M]=(0,r.useState)(!0),[G,R]=(0,r.useState)([]),[F,_]=(0,r.useState)(!0),[T,I]=(0,r.useState)(["mock1","mock2"]),[q,O]=(0,r.useState)("mock1"),[z,B]=(0,r.useState)({}),[U,L]=(0,r.useState)({}),[Y,Q]=(0,r.useState)(!0),[W,H]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{let e=(0,x.H9)(m.db,"examControls","mock3"),t=await (0,x.x7)(e);t.exists()&&t.data().isPublished?I(["mock1","mock2","mock3"]):I(["mock1","mock2"])})()},[]);let J=e=>{Y||O(e)};(0,r.useEffect)(()=>{(async()=>{if(M(!0),!y){M(!1);return}let e="jsNPWKOrDtmQdmrs9F8brzcEV9aSW34r7baiq1f74julcLcuZl2WXmzNEQ4C23Mo";if(!e){console.error("Secret Key is not defined in environment variables."),M(!1);return}let t="/api/sheet-data?student_id=".concat(y,"&secret=").concat(e);try{let e=await fetch(t);if(!e.ok)throw Error("Failed to fetch progress");let s=await e.json();console.log("Data received from sheet:",s),s.status&&v(s.status),s.seat&&N(String(s.seat)),s.phone&&E(String(s.phone))}catch(e){console.error("Error fetching progress:",e)}finally{M(!1)}})()},[y]),(0,r.useEffect)(()=>{let e;if(b)return(async()=>{_(!0);try{let t=(0,x.P)((0,x.rJ)(m.db,"students"),(0,x._M)("authUid","==",b),(0,x.AB)(1)),s=await (0,x.GG)(t);if(s.empty){_(!1);return}let a=s.docs[0].data(),r=await (0,x.GG)((0,x.rJ)(m.db,"classes")),l={};r.forEach(e=>{l[e.id]=e.data()});let n=a.class?l[a.class]:null,o=null==n?void 0:n.studyDays,i=[],c=new Date;for(;i.length<10&&i.length<365;)(0,h.hI)(c,o)&&i.push(c.toISOString().split("T")[0]),c.setDate(c.getDate()-1);let d=(0,x.P)((0,x.rJ)(m.db,"permissions"),(0,x._M)("authUid","==",b),(0,x._M)("status","==","approved")),u=(await (0,x.GG)(d)).docs.map(e=>e.data()),p=(e,t)=>t.some(t=>e>=t.permissionStartDate&&e<=t.permissionEndDate);if(i.length>0){let t=(0,x.P)((0,x.rJ)(m.db,"attendance"),(0,x._M)("authUid","==",b),(0,x._M)("date","in",i));e=(0,x.aQ)(t,e=>{let t={};e.docs.forEach(e=>{t[e.data().date]={...e.data(),id:e.id}});let s=i.map(e=>t[e]?t[e]:p(e,u)?{id:e,date:e,status:"permission"}:{id:e,date:e,status:"absent"});R(s),_(!1)})}else _(!1)}catch(e){console.error("Error fetching attendance:",e),_(!1)}})(),()=>{e&&e()}},[b]),(0,r.useEffect)(()=>{y&&(async()=>{let e=window.scrollY;Q(!0);try{let e=(0,x.H9)(m.db,"students",y),t=await (0,x.x7)(e);if(!t.exists())throw Error("Student document not found");let s=t.data().class,a=(0,x.P)((0,x.rJ)(m.db,"classes"),(0,x._M)("name","==",s),(0,x.AB)(1)),r=await (0,x.GG)(a);if(r.empty)throw console.error('Class document not found for name: "'.concat(s,'"')),Error("Class document not found");let l=r.docs[0].data().type;H(l);let n=(0,x.P)((0,x.rJ)(m.db,"examSettings"),(0,x._M)("type","==",l),(0,x._M)("mock","==",q)),o=await (0,x.GG)(n),i={};o.forEach(e=>{let t=e.data();i[t.subject]={maxScore:t.maxScore}}),B(i);let c="/api/sheet-data?student_id=".concat(y,"&secret=").concat("jsNPWKOrDtmQdmrs9F8brzcEV9aSW34r7baiq1f74julcLcuZl2WXmzNEQ4C23Mo","&exam_name=").concat(q),d=await fetch(c),u=await d.json(),h={};u.scores&&Object.keys(i).forEach(e=>{h[e]=Number(u.scores[e])||0}),L(h)}catch(e){console.error("Error fetching data for ".concat(q,":"),e),B({}),L({})}finally{Q(!1),setTimeout(()=>{window.scrollTo(0,e)},0)}})()},[y,q]),(0,r.useEffect)(()=>{if(!Y&&o.current){let e=o.current.getBoundingClientRect().top+window.scrollY;window.scrollY>e&&o.current.scrollIntoView({block:"start",behavior:"instant"})}},[Y,q]);let V=()=>{l(!1)},K=(e,t)=>{if(0===t)return"N/A";let s=e/t;return s>=.9?"A":s>=.8?"B":s>=.7?"C":s>=.6?"D":s>=.5?"E":"F"},X=(0,r.useMemo)(()=>["math","khmer","chemistry","physics","biology","history","english"],[]),Z=(0,r.useMemo)(()=>({math:"Khmer",khmer:"Math",chemistry:"History",physics:"Moral",biology:"Geometry",history:"Earth",english:"English"}),[]),$=(0,r.useMemo)(()=>{let e=Object.keys(z),t=0,s=0;e.forEach(e=>{let a=U[e]||0;if("english"===e.toLowerCase())a>25&&(t+=a-25);else{var r;t+=a,s+=(null===(r=z[e])||void 0===r?void 0:r.maxScore)||0}});let a=s>0?t/s*100:0,r=K(t,s);return{subjects:e,totalScore:t,totalMaxScore:s,totalPercentage:a,totalGrade:r}},[z,U]),ee=D($.totalScore,3e3,[q]),{room:et,seat:es}=(0,r.useMemo)(()=>{if("string"!=typeof w||w.length<3)return{room:"?",seat:"?"};let e=w.length,t=w.substring(e-2);return{room:w.substring(0,e-2),seat:t}},[w]),{phonePocketHolder:ea,phonePocketSlot:er}=(0,r.useMemo)(()=>{if(console.log("Phone Info",S),"string"!=typeof S||3!==S.length)return{phonePocketHolder:"?",phonePocketSlot:"?"};let e=S.substring(0,1);return console.log("Phone INfo",S),{phonePocketHolder:e,phonePocketSlot:S.substring(1)}},[S]);return(0,a.jsx)(C,{children:r=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.A,{title:"Your Personal QR Code",isActive:e,onConfirm:()=>t(!1),onCancel:()=>t(!1),children:(0,a.jsx)(A,{studentName:g||"",studentUid:b||"",qrSize:256})}),(0,a.jsx)(f.A,{title:"Request Permission for Absence",isActive:s,onCancel:()=>l(!1),children:(0,a.jsx)(k,{onSuccess:V})}),(0,a.jsxs)("div",{className:"p-4 max-w-2xl mx-auto",children:[(0,a.jsx)(i,{status:j,loading:P}),!P&&(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mb-6 mt-6",children:[(0,a.jsxs)("div",{className:"relative h-32",children:[(0,a.jsx)(n.default,{src:"/door.png",alt:"Room",width:80,height:80,className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 -ml-4"}),(0,a.jsx)("div",{className:"relative bg-slate-900 rounded-2xl h-full ml-6 px-4 py-2 flex flex-col ".concat("No Registered"===j?"justify-center items-center":"justify-between items-end"),children:"No Registered"===j?(0,a.jsx)("span",{className:"text-center text-sm font-semibold text-yellow-300 animate-pulse pl-6",children:"Register to View your Exam Room"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:"Room"}),(0,a.jsx)("span",{className:"text-5xl font-bold text-white",children:et})]})})]}),(0,a.jsxs)("div",{className:"relative h-32",children:[(0,a.jsx)(n.default,{src:"/school-desk.png",alt:"Seat",width:80,height:80,className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 saturate-125 contrast-125"}),(0,a.jsx)("div",{className:"relative bg-slate-900 rounded-2xl h-full ml-6 px-4 py-2 flex flex-col ".concat("Paid Star"===j||"Borrow"===j?"justify-between items-end":"justify-center items-center"),children:"Paid Star"===j||"Borrow"===j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:"Seat"}),(0,a.jsx)("span",{className:"text-5xl font-bold text-white",children:es})]}):(0,a.jsx)("span",{className:"text-center text-sm font-semibold text-yellow-300 animate-pulse pl-8",children:"Pay STAR to View your Exam Seat"})})]}),(0,a.jsxs)("div",{className:"relative h-32",children:[(0,a.jsx)(n.default,{src:"/pocket.png",alt:"Phone Pocket",width:80,height:80,className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 -ml-4 saturate-125 contrast-125"}),(0,a.jsx)("div",{className:"relative bg-slate-900 rounded-2xl h-full ml-6 px-4 py-2 flex flex-col ".concat("Paid Star"===j||"Borrow"===j?"justify-between items-end":"justify-center items-center"),children:""!==j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:"Phone Pocket"}),(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsx)("span",{className:"text-5xl font-bold text-white",children:ea}),(0,a.jsxs)("span",{className:"text-xl font-semibold text-gray-400 ml-2",children:["#",er]})]})]}):(0,a.jsx)("span",{className:"text-center text-sm font-semibold text-yellow-300 animate-pulse pl-8",children:"Register to View your Phone Pocket"})})]})]}),(0,a.jsx)("hr",{className:"my-4 border-slate-800"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Mock Exam Results"}),(0,a.jsx)(c,{tabs:T,selectedTab:q,setSelectedTab:J,disabled:Y}),Y?(0,a.jsx)("div",{className:"text-center text-gray-400 p-8",children:"Loading scores..."}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"space-y-6",children:(()=>{let e=Object.keys(z).length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center p-6 bg-slate-900 rounded-2xl",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d,{percentage:$.totalPercentage}),(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,a.jsx)("span",{className:"text-4xl font-bold text-white",children:ee}),(0,a.jsx)("span",{className:"text-lg text-gray-400",children:"Total Score"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsxs)("span",{className:"text-2xl font-bold text-purple-400",children:["Grade: ",$.totalGrade]})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:X.map(e=>{if(U.hasOwnProperty(e)){var t,s;let r="Grade 12 Social"===W&&Z[e]||e;return(0,a.jsx)(u,{subject:r,score:U[e],maxScore:(null===(t=z[e])||void 0===t?void 0:t.maxScore)||0,grade:K(U[e],(null===(s=z[e])||void 0===s?void 0:s.maxScore)||0)},e)}return null})})]}):(0,a.jsx)("div",{className:"text-center text-gray-400 p-8",children:"No results found for this exam."});return"mock3"!==q?e:"Paid Star"===j?e:(0,a.jsxs)("div",{className:"text-center text-yellow-400 bg-yellow-500/10 p-6 border border-yellow-500/30 rounded-2xl",children:[(0,a.jsx)("p",{className:"font-bold text-lg animate-pulse",children:"Payment Required"}),(0,a.jsx)("p",{className:"mt-2 text-sm animate-pulse",children:"Please pay your Star Debt first to view your Mock 3 results."})]})})()})})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,992,965,164,173,391,748,565,187,167,84,441,517,358],()=>t(2279)),_N_E=e.O()}]);